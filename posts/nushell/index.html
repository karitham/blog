<!DOCTYPE html>
<html lang="en">
  <head id="head">
    <meta charset="UTF-8">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@KarithamIRL">
    <meta name="twitter:author" content="@KarithamIRL">
    <meta name="twitter:description" content="Shells have been held back far too long by sh compatibility, and the ecosystem suffered.">
    <meta name="twitter:title" content="Nushell is great">
    <meta name="twitter:image" content="/android-chrome-512x512.png">
    <meta property="og:title" content="Nushell is great">
    <meta property="og:type" content="website">
    <meta property="og:image" content="/android-chrome-512x512.png">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Shells have been held back far too long by sh compatibility, and the ecosystem suffered.">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <title id="title">
      Nushell is great- Kar
    </title>
    <link rel="stylesheet" type="text/css" href="/normalize.css">
    <link rel="stylesheet" type="text/css" href="/ctp.css">
    <link rel="stylesheet" type="text/css" href="/style.css">
    

  </head>
  <body>
    <div id="content">
      
  <nav id="nav">
    <ul>
      <li><a href="/" role="button" class="button">~/</a></li>
    </ul>
  </nav>
  <div id="main">
    
  <main>
    <div class="post">
      <h1>Nushell is great</h1>
      <div class="head-footer">
        <div>By
          <span class="emph">Karitham</span></div>
        <div
        >Posted on:
          <span class="emph">September 21, 2024</span></div>
        <div class="tags">
          
            Tags:
            
              <span class="emph">nushell</span><span>,</span>
            
              <span class="emph">scripting</span><span></span>
            
          
        </div>
      </div>
      <div><p>I dislike configuring my software. I like when the defaults are sane and powerful. I like when I can just pop in once in a while in the configuration settings. Add something (not remove it), and it just works.</p><p>Fish is like that. I used it for the longest time. Then I got swept up by the mass of zsh users with their fancy looking prompts, and their <em>standards</em>. So, for the past 2 years I’ve used zsh. It didn’t really make much of a difference to me, except the scripting part was just a little bit worse. Less ergonomic.</p><p>Since then, I’ve learned a lot and switched roles, ending up in a SRE/Ops sort of situation where I write a ton more scripts, or write big one-liners. Unfortunately, I’m bad at that.</p><p>What I’m good at, is high level, typed, functional languages. So when I discovered <a href="https://www.nushell.sh/" target="_blank">nushell</a>, I was sold.</p><p>The model is quite intuitive and more representative of modern programming languages. Types are either primitives (<code>int</code>,<code>string</code>,<code>bool</code>), records (sometimes called tables) or lists. Yes, there’s bools.</p><p>Nu allows you to represent most data formats natively, and it has built-in support for a huge number of them, with a plugin system to allow even more. It can ingest csv and turn it into yaml, no dirty sed + awk’ing.</p><h2>Example</h2><p><figure><pre><code class="nu"><span class="keyword directive">#!/usr/bin/env nu
</span>
<span class="keyword">let</span> <span class="variable">ns_names</span><span class="punctuation special">:</span> <span class="type enum">list</span><span class="punctuation bracket">&lt;</span><span class="type">string</span><span class="punctuation bracket">&gt;</span> <span class="operator">=</span> <span class="punctuation bracket">[</span>
    <span class="variable parameter">&quot;standalone&quot;</span>,
    <span class="punctuation bracket">(</span><span class="variable parameter">&quot;service1-{test,stag,prod}&quot;</span> <span class="operator">|</span> <span class="function builtin">str</span> <span class="variable parameter">expand</span><span class="punctuation bracket">)</span>,
    <span class="punctuation bracket">(</span><span class="variable parameter">&quot;service2-{test,stag,prod}&quot;</span> <span class="operator">|</span> <span class="function builtin">str</span> <span class="variable parameter">expand</span><span class="punctuation bracket">)</span>,
    <span class="punctuation bracket">(</span><span class="variable parameter">&quot;team3-{test,stag,prod}&quot;</span> <span class="operator">|</span> <span class="function builtin">str</span> <span class="variable parameter">expand</span><span class="punctuation bracket">)</span>,
<span class="punctuation bracket">]</span> <span class="operator">|</span> <span class="function builtin">flatten</span> <span class="operator">|</span> <span class="function builtin">sort</span>

<span class="keyword">let</span> <span class="variable">namespaces</span> <span class="operator">=</span> <span class="none">$ns_names</span> <span class="operator">|</span> <span class="function builtin">each</span> <span class="punctuation bracket">{</span><span class="punctuation bracket">{</span>
    <span class="property">apiVersion</span><span class="punctuation special">:</span> <span class="variable parameter">&quot;v1&quot;</span>,
    <span class="property">kind</span><span class="punctuation special">:</span> <span class="variable parameter">&quot;Namespace&quot;</span>,
    <span class="property">metadata</span><span class="punctuation special">:</span> <span class="punctuation bracket">{</span> <span class="property">name</span><span class="punctuation special">:</span> <span class="none">$in</span> <span class="punctuation bracket">}</span>,
<span class="punctuation bracket">}</span><span class="punctuation bracket">}</span>

<span class="punctuation bracket">{</span>
    <span class="property">apiVersion</span><span class="punctuation special">:</span> <span class="variable parameter">&quot;v1&quot;</span>,
    <span class="property">kind</span><span class="punctuation special">:</span> <span class="variable parameter">&quot;List&quot;</span>,
    <span class="property">items</span><span class="punctuation special">:</span> <span class="none">$namespaces</span>
<span class="punctuation bracket">}</span> <span class="operator">|</span> <span class="function builtin">to</span> <span class="variable parameter">yaml</span> <span class="operator">|</span> <span class="function builtin">save</span> <span class="punctuation delimiter">-</span><span class="attribute">f</span> <span class="string">$&quot;</span><span class="variable parameter">(</span><span class="none">$env.PROCESS_PATH</span> <span class="operator">|</span> <span class="function builtin">path</span> <span class="variable parameter">dirname</span><span class="variable parameter">)</span><span class="string">/namespaces.yaml</span><span class="string">&quot;</span></code></pre>
<figcaption>Original nushell script</figcaption></figure></p><p>gives</p><pre><code class="yaml"><span class="property">kind</span><span class="punctuation delimiter">:</span> <span class="string">List</span>
<span class="property">apiVersion</span><span class="punctuation delimiter">:</span> <span class="string">v1</span>
<span class="property">items</span><span class="punctuation delimiter">:</span>
<span class="punctuation delimiter">-</span> <span class="property">apiVersion</span><span class="punctuation delimiter">:</span> <span class="string">v1</span>
  <span class="property">kind</span><span class="punctuation delimiter">:</span> <span class="string">Namespace</span>
  <span class="property">metadata</span><span class="punctuation delimiter">:</span>
    <span class="property">name</span><span class="punctuation delimiter">:</span> <span class="string">service1-prod</span>
<span class="punctuation delimiter">-</span> <span class="property">apiVersion</span><span class="punctuation delimiter">:</span> <span class="string">v1</span>
  <span class="property">kind</span><span class="punctuation delimiter">:</span> <span class="string">Namespace</span>
  <span class="property">metadata</span><span class="punctuation delimiter">:</span>
    <span class="property">name</span><span class="punctuation delimiter">:</span> <span class="string">service1-stag</span>
<span class="punctuation delimiter">-</span> <span class="property">apiVersion</span><span class="punctuation delimiter">:</span> <span class="string">v1</span>
  <span class="property">kind</span><span class="punctuation delimiter">:</span> <span class="string">Namespace</span>
  <span class="property">metadata</span><span class="punctuation delimiter">:</span>
    <span class="property">name</span><span class="punctuation delimiter">:</span> <span class="string">service1-test</span>
<span class="punctuation special">...</span>
</code></pre>
<p>I’m sparing you <a href="/posts/nushell/namespaces.yaml">the rest</a>.</p><p>Here’s the bash way of doing things (to the best of my abilities)</p><p><figure><pre><code class="bash"><span class="comment">#!/usr/bin/env bash</span>

<span class="comment"># Define the namespace names</span>
<span class="property">ns_names</span>=(
    <span class="string">&quot;standalone&quot;</span>
    <span class="embedded">$(eval echo &quot;service1-{test,stag,prod}&quot;)</span>
    <span class="embedded">$(eval echo &quot;service2-{test,stag,prod}&quot;)</span>
    <span class="embedded">$(eval echo &quot;team3-{test,stag,prod}&quot;)</span>
)

<span class="comment"># Sort the namespace names</span>
<span class="property">IFS</span>=$&apos;\n&apos; <span class="property">sorted_ns</span>=(<span class="embedded">$(sort &lt;&lt;&lt;&quot;${ns_names[*]}&quot;)</span>)
<span class="keyword">unset</span> <span class="property">IFS</span>

<span class="comment"># Generate the YAML output</span>
{
    <span class="constant">echo</span> <span class="constant">&quot;apiVersion: v1&quot;</span>
    <span class="constant">echo</span> <span class="constant">&quot;kind: List&quot;</span>
    <span class="constant">echo</span> <span class="constant">&quot;items:&quot;</span>
    <span class="keyword">for</span> <span class="property">ns</span> <span class="keyword">in</span> <span class="string">&quot;${sorted_ns[@]}&quot;</span>; <span class="keyword">do</span>
        <span class="constant">echo</span> <span class="constant">&quot;- apiVersion: v1&quot;</span>
        <span class="constant">echo</span> <span class="constant">&quot;  kind: Namespace&quot;</span>
        <span class="constant">echo</span> <span class="constant">&quot;  metadata:&quot;</span>
        <span class="constant">echo</span> <span class="constant">&quot;    name: $ns&quot;</span>
    <span class="keyword">done</span>
} <span class="operator">&gt;</span><span class="string">&quot;$(dirname &quot;$0&quot;)/namespaces.yaml&quot;</span>
</code></pre>
<figcaption>A bash alternative</figcaption></figure></p><h2>Using it day to day</h2><p>You might be wondering why we’re outputting yaml here, instead of directly applying it.</p><p>It would be a great option when working on a solo project, but on a project you don’t own, I rather give an escape hatch.</p><p>New, shiny tools have a low adoption, and you can’t expect everyone to have them installed on their system (yes, they could just use <a href="https://nixos.org" target="_blank"><code>nix</code></a>).</p><p>Saving the results as a file that gets commited to git makes collaboration that much easier. If others just want to append to the list manually they can do so. I can keep using my script as long as I keep it up to date. Unfortunately, that’s the cost to pay for using non-standard tools.</p><p>On solo projects, the script above would be simpler, and could even be abstracted to build an entire k8s cluster the GitOps way, only through nushell!</p></div>
    </div>
  </main>

  </div>

    </div>
  </body>
  <footer id="footer">
    
  </footer>
</html>